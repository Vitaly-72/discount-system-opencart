# discount-system-opencart
Система скидок по количеству для OpenCart
## Назначение кода
Данный код реализует систему применения скидок в зависимости от количества товара в корзине. Особенность реализации заключается в том, что каждая комбинация "товар + опция" считается отдельно при расчете скидки.

## Логика работы
### Основной принцип
* Скидка применяется только если количество конкретной комбинации товара с опцией достигает минимального порога
* Скидка не применяется если количество меньше минимального порога
* Каждая комбинация товара и опции рассчитывается независимо

 ### Код с комментариями
```
находиться в code with comments.php
```
### Ключевые особенности
1. Изоляция комбинаций
* Каждая комбинация "товар + набор опций" рассматривается как отдельная позиция:
* Товар 171 + опция "бежевый"
* Товар 171 + опция "красный"
* Товар 171 + без опций

2. Гибкие правила
Можно задать разные минимальные количества для разных товаров:
```
$discount_rules = array(
    171 => 30,  // Профнастил - от 30 м²
    113 => 10,  // Саморезы - от 10 упаковок
    200 => 50   // Черепица - от 50 листов
);
```

### Чтобы добавить новый товар в систему скидок, нужно:

Найти ID товара в админке OpenCart
Добавить в массив $discount_rules:
```
$discount_rules = array(
    171 => 30,   // существующий товар
    174 => 30,   // существующий товар
    200 => 25,   // НОВЫЙ товар ID 200, скидка от 25 шт
    201 => 15    // НОВЫЙ товар ID 201, скидка от 15 шт
);
```
## Расположение файла
Код должен быть размещен в файле:
```
system/library/cart/cart.php
```
найти в файле строку и добавить после нее ПРАВИЛА СКИДОК ПО КОЛИЧЕСТВУ
```
// Product Specials - стандартный запрос акционных цен OpenCart
$product_special_query = $this->db->query("SELECT price FROM " . DB_PREFIX . "product_special WHERE product_id = '" . (int)$cart['product_id'] . "' AND customer_group_id = '" . (int)$this->config->get('config_customer_group_id') . "' AND ((date_start = '0000-00-00' OR date_start < NOW()) AND (date_end = '0000-00-00' OR date_end > NOW())) ORDER BY priority ASC, price ASC LIMIT 1");

```
